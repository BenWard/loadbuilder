#!/usr/bin/env node

var opts = require('opts'),
    loadbuilder = require('../lib/loadbuilder');

var options = [
  {
    short       : 'x',
    long        : 'exclude',
    description : 'Exclude scripts',
    value       : true,
    default     : '',
  },
  {
    short       : 'nm',
    long        : 'nomin',
    description : 'Don\'t minify',
  },
  {
    short       : 'm',
    long        : 'modPath',
    description : 'Module path, relative to document root',
    value       : true,
  },
  {
    short       : 'o',
    long        : 'distRoot',
    description : 'Output root',
    value       : true,
  },
  {
    short       : 'd',
    long        : 'docRoot',
    description : 'Document root',
    value       : true,
  },
];

var arguments = [ { name : 'file' , required : true } ];

opts.parse(options, arguments, true);

var main = opts.arg('file');

var LB = loadbuilder.builder({
  exclude   : (opts.get('x') || '').split(','),
  docRoot   : opts.get('d') || process.cwd(),
  distRoot  : opts.get('o') || process.cwd() + "/dist",
  modPath   : opts.get('m') || '',
  nomin     : opts.get('nm'),
});

LB.load(main).minify().save(opts.get('o') || main.replace(/\.js$/,'')+'.lb.js');